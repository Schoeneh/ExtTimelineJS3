<html>

<head>
    <title>Bundled TimelineJS test page</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <!-- this is normally done by embed page -->
    <script>
        var options = {
            lang: 'es',
            debug: true,
            height: 650,
            soundcite: true,
            hash_bookmark: true,
            start_at_end: false,
            autolink: false,
            ga_measurement_id: 'G-LVEFKMG087',
            sheets_proxy: 'https://sheets-proxy.knightlab.com/proxy/'
        }


        function ready(fn) {
            if (document.readyState != 'loading') {
                fn();
            } else {
                document.addEventListener('DOMContentLoaded', fn);
            }
        }

        function timelineFromInput() {
            document.getElementById('timeline-embed').innerHTML = ''
            var dataUrl = document.getElementById('timeline-src').value
            window.timeline = new TL.Timeline('timeline-embed', dataUrl, options)
        }

        ready(function() {

            // sanitize test
            // var dataUrl = 'https://docs.google.com/spreadsheets/d/1Q4-R3mlK7w1liCEl5_SGPaeLpfHDVdMtc83rjSTHBZo/edit#gid=0'

            // Zander Work's exploit
            // var dataUrl = 'https://docs.google.com/spreadsheets/d/1Jt5Csoku0W73100mnG_byVdvCFLXT8G5gG9lu1yggA0/edit#gid=0'

            // women in computing:
            var dataUrl = 'https://docs.google.com/spreadsheets/u/1/d/1xuY4upIooEeszZ_lCmeNx24eSFWe0rHe9ZdqH2xqVNk/pubhtml';

            window.timeline = new TL.Timeline('timeline-embed', dataUrl, options)

            window.timeline.on("ready", () => {
                console.log("Timeline ready event fired")
            })


            document.getElementById('timeline-src').value = dataUrl
            document.getElementById('timeline-src').addEventListener('keyup', (e) => {
                e.preventDefault();
                if (e.keyCode === 13) {
                    timelineFromInput()
                }
            })

            document.querySelectorAll('nav a').forEach(el => {
                el.addEventListener('click', e => {
                    window.location.hash = ''
                    e.preventDefault()
                    let url = e.target.attributes['href'].value
                    document.getElementById('timeline-src').value = url
                    timelineFromInput()
                })
            })
        })

        
        
      // Initialize the editor with a JSON schema
      var editor = new JSONEditor(document.getElementById('editor_holder'),{
        schema: {
          type: "object",
          title: "Car",
          properties: {
            make: {
              type: "string",
              enum: [
                "Toyota",
                "BMW",
                "Honda",
                "Ford",
                "Chevy",
                "VW"
              ]
            },
            model: {
              type: "string"
            },
            year: {
              type: "integer",
              enum: [
                1995,1996,1997,1998,1999,
                2000,2001,2002,2003,2004,
                2005,2006,2007,2008,2009,
                2010,2011,2012,2013,2014
              ],
              default: 2008
            },
            safety: {
              type: "integer",
              format: "rating",
              maximum: "5",
              exclusiveMaximum: false,
              readonly: false
            }
          }
        }
      });

      // Hook up the submit button to log to the console
      document.getElementById('submit').addEventListener('click',function() {
        // Get the value from the editor
        console.log(editor.getValue());
      });
    
    

    </script>
    <style>
        body {
            font-family: sans-serif;
            background-color: #ddd;
        }
        
        #timeline-embed {
            margin: 1em 0;
            height: 650px;
        }
        
        input[type="text"] {
            font-size: 12pt
        }
        
        nav {
            margin: 10px 0;
        }
        
        nav a {
            margin: 5px;
        }
    </style>
</head>

<body>
    <h1>Editor Test</h1>
    <div id="editor_holder">
    <div data-schemaid="root" data-schematype="object" data-schemapath="root" class="je-object__container">
        <span class="je-header je-object__title">
            <button type="button" class="json-editor-btn-collapse json-editor-btntype-toggle">
                <span>Collapse</span></button><span>Car</span></span><span class="je-object__controls"><div style="display: none;" class="je-modal"><label style="position: absolute;width: 1px;height: 1px;padding: 0;margin: -1px;overflow: hidden;clip: rect(0,0,0,0);border: 0;" for="root-edit-json-textarea">Edit JSON</label><textarea class="je-textarea je-edit-json--textarea" id="root-edit-json-textarea" aria-labelledby="root-edit-json-textarea"></textarea><button type="button" class="json-editor-btn-save json-editor-btntype-save"><span>Save</span></button><button type="button" class="json-editor-btn-copy json-editor-btntype-copy"><span>Copy</span></button><button type="button" class="json-editor-btn-cancel json-editor-btntype-cancel"><span>Cancel</span></button></div>
                <div style="display: none;" class="je-modal"><div class="property-selector"><div class="form-control" style="margin-top: 0px; padding-top: 0px; margin-bottom: 0px; padding-bottom: 0px; height: auto;"><label for="root-make">
                    <input type="checkbox" class="je-checkbox" style="width: auto;" id="root-make">&nbsp;make</label></div><div class="form-control" style="margin-top: 0px; padding-top: 0px; margin-bottom: 0px; padding-bottom: 0px; height: auto;"><label for="root-model"><input type="checkbox" class="je-checkbox" style="width: auto;" id="root-model">&nbsp;model</label></div><div class="form-control" style="margin-top: 0px; padding-top: 0px; margin-bottom: 0px; padding-bottom: 0px; height: auto;"><label for="root-year"><input type="checkbox" class="je-checkbox" style="width: auto;" id="root-year">&nbsp;year</label></div><div class="form-control" style="margin-top: 0px; padding-top: 0px; margin-bottom: 0px; padding-bottom: 0px; height: auto;"><label for="root-safety"><input type="checkbox" class="je-checkbox" style="width: auto;" id="root-safety">&nbsp;safety</label></div></div><label style="position: absolute;width: 1px;height: 1px;padding: 0;margin: -1px;overflow: hidden;clip: rect(0,0,0,0);border: 0;" for="root-property-selector">Properties</label><input type="text" placeholder="Property name..." class="property-selector-input" id="root-property-selector" aria-labelledby="root-property-selector"><button type="button" class="json-editor-btn-add json-editor-btntype-add"><span>Add</span></button><div style="clear: both;"></div></div><button type="button" class="json-editor-btn-edit json-editor-btntype-editjson"><span>Edit JSON</span></button><button type="button" class="json-editor-btn-edit_properties json-editor-btntype-properties"><span>Object Properties</span></button></span><div style="display: none;"></div><div class="je-indented-panel" style=""><div><div><div class="row"><div data-schematype="string" data-schemapath="root.make"><div class="form-control"><label class="je-form-input-label" for="root[make]">make</label><select id="root[make]" name="root[make]"><option value="Toyota">Toyota</option><option value="BMW">BMW</option><option value="Honda">Honda</option><option value="Ford">Ford</option><option value="Chevy">Chevy</option><option value="VW">VW</option></select></div><div></div></div></div><div class="row"><div data-schematype="string" data-schemapath="root.model"><div class="form-control"><label class="je-form-input-label" for="root[model]">model</label><input type="text" id="root[model]" name="root[model]"></div><div></div></div></div><div class="row"><div data-schematype="integer" data-schemapath="root.year"><div class="form-control"><label class="je-form-input-label" for="root[year]">year</label><select id="root[year]" name="root[year]"><option value="1995">1995</option><option value="1996">1996</option><option value="1997">1997</option><option value="1998">1998</option><option value="1999">1999</option><option value="2000">2000</option><option value="2001">2001</option><option value="2002">2002</option><option value="2003">2003</option><option value="2004">2004</option><option value="2005">2005</option><option value="2006">2006</option><option value="2007">2007</option><option value="2008">2008</option><option value="2009">2009</option><option value="2010">2010</option><option value="2011">2011</option><option value="2012">2012</option><option value="2013">2013</option><option value="2014">2014</option></select></div><div></div></div></div><div class="row"><div data-schematype="integer" data-schemapath="root.safety"><div class="form-control"><b>safety</b><div name="root[safety]"><div class="starrating"><input type="radio" name="root[safety][starrating]" value="5" id="root[safety]5"><label for="root[safety]5" title="5"><span style="position: absolute;width: 1px;height: 1px;padding: 0;margin: -1px;overflow: hidden;clip: rect(0,0,0,0);border: 0;">4</span></label><input type="radio" name="root[safety][starrating]" value="4" id="root[safety]4"><label for="root[safety]4" title="4"><span style="position: absolute;width: 1px;height: 1px;padding: 0;margin: -1px;overflow: hidden;clip: rect(0,0,0,0);border: 0;">3</span></label><input type="radio" name="root[safety][starrating]" value="3" id="root[safety]3"><label for="root[safety]3" title="3"><span style="position: absolute;width: 1px;height: 1px;padding: 0;margin: -1px;overflow: hidden;clip: rect(0,0,0,0);border: 0;">2</span></label><input type="radio" name="root[safety][starrating]" value="2" id="root[safety]2"><label for="root[safety]2" title="2"><span style="position: absolute;width: 1px;height: 1px;padding: 0;margin: -1px;overflow: hidden;clip: rect(0,0,0,0);border: 0;">1</span></label><input type="radio" name="root[safety][starrating]" value="1" id="root[safety]1"><label for="root[safety]1" title="1"><span style="position: absolute;width: 1px;height: 1px;padding: 0;margin: -1px;overflow: hidden;clip: rect(0,0,0,0);border: 0;">0</span></label></div></div></div><div></div></div></div></div></div></div><div></div></div>
    </div>
    <button id="submit">Submit (console.log)</button>
    <h1>Timeline Development</h1>
    <div>
        <label for="timeline-src">data source URL:</label><input type="text" size="120" name="timeline-src" id="timeline-src" />
    </div>
    <nav>
        <a href='https://docs.google.com/spreadsheets/u/1/d/1xuY4upIooEeszZ_lCmeNx24eSFWe0rHe9ZdqH2xqVNk/pubhtml'>Women in Computing</a>
        <a href="all-media-types.json">All Media Types</a>
        <a href="eras.json">Eras</a>
    </nav>
    <div id='timeline-embed'></div>
</body>

</html>
